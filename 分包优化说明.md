# fuyuntuku-13 分包优化说明

## 优化目标

将编译后的正式包 base 包大小控制在 40KB 以内

## 已完成的优化

### 1. 创建分包结构

- 创建 `src/pkg_main` 分包目录
- 包含子目录：`assets/img`, `helper`, `widgets`, `pages`

### 2. 页面分包配置

#### 主包页面（pages/）

仅保留必要的入口页面：

- `Splash` - 启动页
- `Home` - 首页
- `Demo` - 示例页
- `DemoDetail` - 示例详情页
- `Web` - Web 视图页

#### 分包页面（pkg_main/pages/）

将所有业务页面移至分包：

- `Wallpaper` - 壁纸页
- `WallpaperDetail` - 壁纸详情
- `WallpaperList` - 壁纸列表
- `Avatar` - 头像页
- `AvatarDetail` - 头像详情
- `AvatarList` - 头像列表
- `Emoji` - 表情包页
- `EmojiDetail` - 表情详情
- `Mine` - 我的页面
- `Collection` - 收藏页

### 3. 资源文件优化

#### 图片资源

**主包图片（src/assets/img/）** 仅保留主包页面必需的 10 个图片文件（约 49KB）：

- logo-3.png (2.29 KB) - 应用 Logo
- shangdianbg.png (42.58 KB) - 背景图
- 6 个 Tab 图标（选中/未选中状态）
  - bizhi-s.png / bizhi-u.png
  - touxiang-s.png / touxiang-u.png
  - biaoqingbao-s.png / biaoqingbao-u.png
  - mine-s.png / mine-u.png

**分包图片（pkg_main/assets/img/）** 移动 25 个业务相关图片到分包

**应用图标（src/assets/images/）** 保持不变，仅包含应用图标 logo.png

**已删除资源**

- `src/assets/UI/` - 删除所有设计稿文件（约 24 个文件）

### 4. Helper 文件分包

将所有 helper 工具文件移至分包：

- `pkg_main/helper/utils.js` - 工具函数
- `pkg_main/helper/ajax.js` - 网络请求封装
- `pkg_main/helper/apis/` - API 配置

更新 `app.ux` 中的引用路径：

```javascript
const $utils = require('./pkg_main/helper/utils').default
const $apis = require('./pkg_main/helper/apis').default
```

### 5. 组件分包

将 widgets 组件移至分包：

- `pkg_main/widgets/CardDemo/` - 卡片组件

### 6. 路径更新

#### 图片路径

- 分包页面中的图片路径：`/assets/img/` → `/pkg_main/assets/img/`

#### 页面路由

- Home 页面导入组件路径：

  - `../Wallpaper/index.ux` → `../../pkg_main/pages/Wallpaper/index.ux`
  - 其他组件同理

- 分包页面间跳转路径：
  - `/pages/WallpaperDetail` → `/pkg_main/pages/WallpaperDetail`
  - `/pages/Collection` → `/pkg_main/pages/Collection`
  - 等等

### 7. manifest.json 配置

添加分包配置：

```json
{
  "router": {
    "entry": "pages/Splash",
    "pages": {
      // 仅包含主包 5 个页面
    }
  },
  "subpackages": [
    {
      "name": "pkg_main",
      "resource": "pkg_main",
      "pages": {
        // 包含 10 个业务页面
      }
    }
  ],
  "display": {
    "pages": {
      // 更新分包页面配置，使用 pkg_main/pages/ 前缀
    }
  }
}
```

## 优化效果预期

### 主包内容

- 5 个页面（Splash, Home, Demo, DemoDetail, Web）
- 10 个小图标和背景图（约 49KB）
- app.ux 和配置文件
- 无 helper、widgets 等辅助文件

### 分包内容

- 10 个业务页面
- 25 个业务图片
- helper 工具函数
- widgets 组件

## 需要注意的问题

⚠️ **shangdianbg.png 文件过大（42.58KB）** 建议采取以下措施之一：

1. 压缩该背景图片，将其压缩到 10KB 以内
2. 使用纯色或渐变色背景替代
3. 将 Home 和 Splash 的背景改为懒加载方式

## 测试建议

1. 执行 `npm run build` 编译项目
2. 检查 `build/` 目录下的 rpk 文件
3. 验证 base 包大小是否小于 40KB
4. 测试所有页面跳转是否正常
5. 测试图片资源是否正常加载
6. 测试分包页面是否能正常使用 $utils 和 $apis 全局方法

## 下一步优化方向

如果 base 包仍然超过 40KB，可以考虑：

1. 压缩或替换 shangdianbg.png 背景图
2. 将部分 Tab 图标改用 CSS 绘制
3. 延迟加载非必需资源
4. 检查并优化 app.ux、global.js 等全局文件大小
